# 時區與「本日」定義

## 「本日」定義

本系統將**「本日」定義為台灣時區 (Asia/Taipei) 的 8:00 AM 到隔日 8:00 AM**。

### 邏輯說明

- **時間範圍**：8:00 AM (含) 到隔日 8:00 AM (不含)
- **時區基準**：Asia/Taipei (UTC+8)
- **實際應用**：
  - 如果現在是 7:59 AM → 視為「昨天」
  - 如果現在是 8:00 AM → 視為「今天」
  - 如果現在是 23:59 PM → 視為「今天」
  - 如果現在是隔日 7:59 AM → 視為「今天」

### 設計理由

1. **符合生活作息**：大部分人在早上 8 點前還沒開始新的一天
2. **避免跨日混亂**：夜貓子用戶在凌晨 1-7 點的回報仍屬於「昨天」
3. **一致性體驗**：確保所有用戶都使用台灣時區，避免時區差異

### 實作範例

```javascript
// 如果當前台灣時間是 2025-07-20 07:30 AM
// → reportDate = 2025-07-19 (昨天)

// 如果當前台灣時間是 2025-07-20 08:00 AM
// → reportDate = 2025-07-20 (今天)

// 如果當前台灣時間是 2025-07-21 03:00 AM  
// → reportDate = 2025-07-20 (今天，因為還沒到 8:00 AM)
```

### 相關函數

- `getTodayProgressByUser()` - 取得今日進度，使用此邏輯
- `createGoalReport()` - 建立回報時，`report_date` 欄位使用此邏輯

### 資料庫儲存

- `goal_reports.report_date`：儲存計算後的日期 (YYYY-MM-DD 格式)
- `goal_reports.report_time`：儲存實際回報的完整時間戳

### 指令影響

- `/today` 指令：顯示根據此邏輯計算的「今日」進度
- `/r` 指令：回報數據會根據此邏輯歸類到正確的日期

---

**重要提醒**：此邏輯影響所有與「日期」相關的功能，包括進度統計、回報記錄等。